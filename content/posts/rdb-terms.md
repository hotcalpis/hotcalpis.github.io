---
title: 'RDB設計の基礎的な概念'
date: '2023-09-11'
description: '正規化や関数従属性など、RDBの設計に関する概念・用語をまとめました'
---

仕事でSQL周りの性能改善をすることが増えてきました。
大抵はインデックスの追加やN+1の解消で改善できるのですが、たまにテーブル設計自体に問題があり、お手上げになってしまうことがあります。

そこで、いい機会なのでRDBの設計においての基本的な概念を見直してみました。
なお、外部キーなどの直感的に分かりやすい概念や、スーパーキーなどの実用的でない概念は省略しています。

## キー

**レコードを特定/識別するための属性の集合。**
英単語で言い換えると `identifiers`。つまりIDをイメージすればいい。

### 主キー

RDBではレコードの一意性を確保する必要がある。
そのために設定する UNIQUE かつ NOT NULL な属性集合が主キー。

### 候補キー

主キーの候補であり、レコードを一意に識別できる属性集合のこと。
ただし、属性が必要最小限であり、どれか一つでも欠ければ一意性を確保できなくなる組合せに限る。

### 非キー属性

候補キーにならない、常に被決定項となる属性のこと。

## 関数従属性

**Aが決まればBも決まるという性質のこと。**
例えば、会員テーブル(<u>会員番号</u>, 名前, 年齢) において、会員番号が決まれば名前も決まるため、**名前は会員番号に関数従属している** と言える。

### 決定項/被決定項

上記のAを決定項、Bを被決定項という。
例だと、会員番号が決定項、名前が被決定項。

### 完全関数従属

候補キーによって非キー属性が決まること。
正規化では全ての属性が完全関数従属となるようにテーブルを分割していく。

### 部分関数従属

候補キーの一部によって非キー属性が決まること。
この従属性を持つ属性は別テーブルに分割すべき。（第2正規化）

### 推移的関数従属

<u>売上ID</u> -> 商品ID -> 商品名 のように、候補キーによって推移的に非キー属性が決まること。
この従属性を持つ属性も別テーブルに分割すべき。（第3正規化）

## 正規化

**データの重複をなくし、1事実1箇所になるように設計すること。**
これにより更新時異状を防ぐことができる。

### 1事実1箇所

1つのデータが1つのテーブルの1つの行にだけ保存されていること。

### 更新時異状

正規化が不十分なテーブルに対して、挿入・更新・削除を行おうとした際に発生する3種類の異状のこと。
例として、第2正規形の 売上テーブル(<u>売上ID</u>, 精算日時, 商品ID, 商品名) に対する更新時異状を考える。

#### 挿入

新しい商品を登録したくても、売上が立つまでは登録できない。

#### 更新

商品名を変更したい場合、該当商品の売上全てを漏れなく同時に更新しないと整合性が失われる。

#### 削除

特定商品の売上を全て削除することによって商品の情報が完全に失われる。

### 情報無損失分解

分解と結合を繰り返しても情報が失われず、同じ結果が得られる分解のこと。
第3正規化までが情報無損失分解であり、ボイス・コッド正規化以降は情報が失われる。
このため実務では第3正規化までを行うことが基本となる。
